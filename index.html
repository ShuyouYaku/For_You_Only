<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Valentine</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
body.hidden { visibility: hidden; }

body {
  font-family: 'Press Start 2P', monospace;
  text-align: center;
  background-color: #fff0f5;
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  flex-direction: column;
}

.btn {
  padding: 10px 20px;
  font-size: 20px;
  margin: 10px;
  cursor: pointer;
  border: none;
  border-radius: 5px;
  transition: transform 0.3s ease;
}

#yesBtn {
  background-color: #ff69b4;
  color: white;
}

#noBtn {
  background-color: #ff4c4c;
  color: white;
}

#response {
  display: none;
  margin-top: 10px;
  font-size: 24px;
  color: red;
}

#noMessage {
  display: none;
  position: fixed;
  inset: 0;
  background-color: black;
  color: red;
  font-family: 'Press Start 2P', monospace;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  padding: 5vh 6vw;
  box-sizing: border-box;
}

#noMessage .main-text {
  font-weight: 800;
  font-size: min(16vw, 16vh);
}

#noMessage .sub-text {
  margin-top: 4vh;
  font-size: clamp(16px, 4vw, 36px);
  color: #ffb3b3;
}
</style>
</head>

<body>
<script>
const sid = localStorage.getItem("sid") || (() => {
  const id = crypto.randomUUID?.() || Math.random().toString(36).slice(2);
  localStorage.setItem("sid", id);
  return id;
})();
</script>
<script>
let TYPE_SPEED = 100;

function typeText(el, text, variance = 20) {
  el.textContent = "";
  let i = 0;
  function tick() {
    if (i < text.length) {
      el.textContent += text[i++];
      setTimeout(tick, TYPE_SPEED + Math.random() * variance);
    }
  }
  tick();
}

function clearUI() {
  document.querySelector("h1")?.remove();
  document.getElementById("buttons")?.remove();
  document.getElementById("cat")?.remove();
  document.getElementById("defaultGif")?.remove();
}

function showYes() {
  clearUI();
  document.getElementById("yesGif").style.display = "block";
  document.getElementById("response").style.display = "block";
}

function showNo() {
  clearUI();
  document.body.style.backgroundColor = "black";

  const box = document.getElementById("noMessage");
  box.style.display = "flex";

  const main = box.querySelector(".main-text").dataset.text;
  const sub  = box.querySelector(".sub-text").dataset.text;

  typeText(box.querySelector(".main-text"), main, 50);
  setTimeout(() => {
    typeText(box.querySelector(".sub-text"), sub, 40);
  }, main.length * 60);
}
document.addEventListener("DOMContentLoaded", () => {
  const saved = localStorage.getItem("finalChoice");
  if (saved === "Yes") showYes();
  if (saved === "No") showNo();
});

function handleResponse(data) {
  if (!data || data.status !== "returning") return;

  localStorage.setItem("finalChoice", data.choice);

  if (data.choice === "Yes") showYes();
  if (data.choice === "No") showNo();
}
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const s = document.createElement("script");
  s.src =
    "https://script.google.com/macros/s/AKfycbyhcLrMwzjRd1Os54LOwlxJcGAIOkTTfbqUoQI18yuXHlSC4TlRu534WppaP_ifnfDYog/exec" +
    "?sid=" + sid +
    "&callback=handleResponse";

  document.body.appendChild(s);
});
</script>

<h1>Do you want to be my Valentine?</h1>

<div id="buttons">
  <button id="yesBtn" class="btn">Yes</button>
  <button id="noBtn" class="btn">No</button>
</div>

<div id="noMessage">
  <span class="main-text" data-text="Sorry for wasting your time."></span>
  <span class="sub-text" data-text="Iâ€™m genuinely happy and thankful that I had the chance to know you. It helped me grow and improve myself. I hope you have a truly wonderful day!"></span>
</div>

<img id="cat" src="https://media.tenor.com/1q_L03jDdJYAAAAC/cute-cat.gif" width="200" />
<img id="defaultGif" src="default.gif" width="250" />
<img id="yesGif" src="yes.gif" width="300" style="display:none" />

<div id="response">
  <h2>Knew you would say yes ðŸ’–</h2>
</div>

<script>
const yesBtn = document.getElementById("yesBtn");
const noBtn  = document.getElementById("noBtn");

yesBtn.onclick = () => {
  localStorage.setItem("finalChoice", "Yes");
  logToSheet("choice", { choice: "Yes" });
  showYes();
};

noBtn.onclick = () => {
  localStorage.setItem("finalChoice", "No");
  logToSheet("choice", { choice: "No" });
  showNo();
};
</script>

<script>
const WEB_APP_URL =
  "https://script.google.com/macros/s/AKfycbyhcLrMwzjRd1Os54LOwlxJcGAIOkTTfbqUoQI18yuXHlSC4TlRu534WppaP_ifnfDYog/exec";


function logToSheet(event, extra = {}) {
  const payload = {
    event,
    sessionId: sid,
    path: location.pathname,
    userAgent: navigator.userAgent,
    extra
  };

  navigator.sendBeacon(
    WEB_APP_URL,
    new Blob([JSON.stringify(payload)], { type: "text/plain" })
  );
}
</script>

</body>
</html>
